import pandas as pd
from sklearn.neighbors import KNeighborsClassifier
from sklearn.preprocessing import LabelEncoder
from sklearn.compose import ColumnTransformer
from sklearn.preprocessing import OneHotEncoder
import joblib

# Load the dataset
file_path = '/path/to/your/dataset.csv'
df = pd.read_csv(file_path)

# Prepare features and labels
X = df[['value']]
y = df['label']

# Encode labels
label_encoder = LabelEncoder()
y_encoded = label_encoder.fit_transform(y)

# Preprocess the 'value' column
preprocessor = ColumnTransformer(
    transformers=[
        ('cat', OneHotEncoder(), ['value'])
    ],
    remainder='passthrough'
)

X_processed = preprocessor.fit_transform(X)

# Initialize KNN classifier
knn = KNeighborsClassifier(n_neighbors=3)

# Train the classifier
knn.fit(X_processed, y_encoded)

# Save the trained model and encoders
joblib.dump(knn, 'knn_model.pkl')
joblib.dump(label_encoder, 'label_encoder.pkl')
joblib.dump(preprocessor, 'preprocessor.pkl')

print("KNN model trained and saved.")
